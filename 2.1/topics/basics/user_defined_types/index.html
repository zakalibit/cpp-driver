<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="DataStax C++ Driver for Apache Cassandra Documentation">
    <meta name="author" content="DataStax">

    <title>DataStax C/C++ Driver - User Defined Types (UDTs)</title>

    <link rel="icon" href="../../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../../favicon.png">
    <link href="../../../../css/style.css" rel="stylesheet">
    <link href="../../../../css/pygments.css" rel="stylesheet">
    <link href="../../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs">
    <div class="navbar">
      <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-left">
          <div class="col-sm-3 text-center">
            <a class="ds-home" href="../../../"><img alt="Brand" src="../../../../img/logo.png"></a>
            <ul class="list-inline ds-sites" role="nav">
              <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
              <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
              <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
            </ul>
          </div>
          <div class="col-md-5">
            <p class="lead pubtitle">DataStax C/C++ Driver</p>
            
            <div class="text-info">
              <span class="text-warning">Attention:</span> Viewing documentation for version
              <div class="btn-group">
                <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  2.1
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                
                  <li><a href="../../../../topics/basics/user_defined_types/">2.5</a></li>
                
                  <li><a href="../../../../2.4/topics/basics/user_defined_types/">2.4</a></li>
                
                  <li><a href="../../../../2.3/topics/basics/user_defined_types/">2.3</a></li>
                
                  <li><a href="../../../../2.2/topics/basics/user_defined_types/">2.2</a></li>
                
                  <li class="disabled"><a href="./">2.1</a></li>
                
                  <li><a href="../../../../2.0/">2.0</a></li>
                
                  <li><a href="../../../../1.0/">1.0</a></li>
                
                </ul>
              </div>
            </div>
            
          </div>
          <div class="col-md-4">
            <form id="search" class="form-search dropdown visible-lg-inline-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
              <div class="form-group has-feedback">
                <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.1')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              </div>
              <ul class="dropdown-menu search-results" role="menu">
                <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
              </ul>
            </form>
            <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3><a href="../../../">Contents</a></h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="../../">
      Getting Started <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../../building/">
      Building <small>page</small>
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="../">
      Basics <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="../keyspaces/">
      Keyspaces <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../futures/">
      Futures <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../binding_parameters/">
      Binding Parameters <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../handling_results/">
      Handling Results <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../schema_metadata/">
      Schema Metadata <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../uuids/">
      UUIDs <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../batches/">
      Batches <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../client_side_timestamps/">
      Client-side timestamps <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../consistency/">
      Consistency <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../data_types/">
      Data Types <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../prepared_statements/">
      Prepared Statements <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../tuples/">
      Tuples <small>page</small>
      
    </a>
    
  </li>
  
  
  <li class="active">
    <a href="./" class="current">
      User Defined Types (UDTs) <small>page</small>
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
</ul>

  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../security/">
      Security <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../logging/">
      Logging <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../configuration/">
      Configuration <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../faq/">
      FAQ <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../metrics/">
      Metrics <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="../../testing/">
      Testing <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../../../api/">
      API docs <small>index</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          <div class="crumbs-wrapper">
            <nav id="crumbs" data-spy="affix" data-offset-top="130">
              <ol class="breadcrumb">
                
                
                
                <li><a href="../../../">Home</a></li>
                
                
                
                
                
                <li><a href="../../">Getting Started</a></li>
                
                
                
                
                
                <li><a href="../">Basics</a></li>
                
                
                
                
                
                <li class="active">User Defined Types (UDTs)</li>
                
                
                
              </ol>
            </nav>
          </div>
          

<h1 id="user-defined-types-ud-ts" class="target">User Defined Types (UDTs)<a class="anchor" href="#user-defined-types-ud-ts" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>

<p>User defined types (UDT) can be used to create arbitrary user types with fields
that can be accessed by name or position. When used with the driver they can be
created from a previously defined type determined from schema or they can be
created from a manually defined data type.</p>

<h2 id="creating-a-udt-from-schema" class="target">Creating a UDT from Schema<a class="anchor" href="#creating-a-udt-from-schema" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>An <a href="../../../api/struct.CassSchema/"><code>CassSchema</code></a> instance can be used to construct a new <a href="../../../api/struct.CassUserType/"><code>CassUserType</code></a>. The
<a href="../../../api/struct.CassSchema/"><code>CassSchema</code></a> instance returns a <a href="../../../api/struct.CassDataType/"><code>CassDataType</code></a> object which is used to
describe Cassandra types including UDTs, tuples, collections and all basic types
(<code>int</code>, <code>bigint</code>, <code>uuid</code>, etc.).</p>
<pre class="highlight"><code><span class="nc">CassSchema</span><span class="o">*</span> <span class="n">schema</span> <span class="o">=</span> <span class="nb">cass_session_get_schema</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>

<span class="nc">CassDataType</span><span class="o">*</span> <span class="n">data_type</span> <span class="o">=</span> <span class="nb">cass_schema_get_udt</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="s">"keyspace"</span><span class="p">,</span> <span class="s">"typename"</span><span class="p">);</span>

<span class="nc">CassUserType</span><span class="o">*</span> <span class="n">user_type</span> <span class="o">=</span> <span class="nb">cass_user_type_new_from_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>

<span class="cm">/* Bind values to user type fields and bind user type to a statement */</span>
</code></pre>
<h2 id="manually-constructing-a-udt-data-type" class="target">Manually Constructing a UDT Data Type<a class="anchor" href="#manually-constructing-a-udt-data-type" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>If schema metadata updates are disabled it is still possible to create UDTs
from a manually construct <a href="../../../api/struct.CassDataType/"><code>CassDataType</code></a>.</p>
<pre class="highlight"><code><span class="nc">CassDataType</span><span class="o">*</span> <span class="n">data_type</span> <span class="o">=</span> <span class="nb">cass_data_type_new_udt</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field1"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_INT</span><span class="p">);</span>
<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field2"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_UUID</span><span class="p">);</span>
<span class="nb">cass_data_type_add_sub_value_type_by_name</span><span class="p">(</span><span class="n">data_type</span><span class="p">,</span> <span class="s">"field3"</span><span class="p">,</span>
<span class="n">CASS_VALUE_TYPE_TEXT</span><span class="p">);</span>

<span class="nc">CassUserType</span><span class="o">*</span> <span class="n">user_type</span> <span class="o">=</span> <span class="nb">cass_user_type_new_from_data_type</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>

<span class="cm">/* Bind values to user type fields */</span>

<span class="nb">cass_data_type_free</span><span class="p">(</span><span class="n">data_type</span><span class="p">);</span>
</code></pre>
<p>The preceding code is equivalent to defining the following schema and using
<a href="../../../api/struct.CassSession/#cass-session-get-schema"><code>cass_session_get_schema()</code></a> obtain the data type.</p>
<pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TYPE</span> <span class="k">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="n">udt</span> <span class="p">(</span><span class="n">field1</span> <span class="k">int</span><span class="p">,</span> <span class="n">field2</span> <span class="k">uuid</span><span class="p">,</span> <span class="n">field3</span> <span class="k">text</span><span class="p">);</span>
</code></pre>
<h2 id="consuming-values-from-a-udt-result" class="target">Consuming values from a UDT result<a class="anchor" href="#consuming-values-from-a-udt-result" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>A UDT returned from Cassandra is consumed by iterating over its fields similar
to the way collections or tuples are consumed.</p>
<pre class="highlight"><code><span class="cm">/* Retrieve UDT value from column */</span>
<span class="k">const</span> <span class="nc">CassValue</span><span class="o">*</span> <span class="n">udt_value</span> <span class="o">=</span> <span class="nb">cass_row_get_column_by_name</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s">"value1"</span><span class="p">);</span>

<span class="cm">/* Create an iterator for the UDT value */</span>
<span class="nc">CassIterator</span><span class="o">*</span> <span class="n">udt_iterator</span> <span class="o">=</span> <span class="nb">cass_iterator_from_user_type</span><span class="p">(</span><span class="n">udt_value</span><span class="p">);</span>

<span class="cm">/* Iterate over the UDT fields */</span>
<span class="k">while</span> <span class="p">(</span><span class="nb">cass_iterator_next</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">field_name</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">field_name_length</span><span class="p">;</span>
  <span class="cm">/* Get UDT field name */</span>
  <span class="nb">cass_iterator_get_user_type_field_name</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">,</span>
                                         <span class="o">&amp;</span><span class="n">field_name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">field_name_length</span><span class="p">);</span>

  <span class="cm">/* Get UDT field value */</span>
  <span class="k">const</span> <span class="nc">CassValue</span><span class="o">*</span> <span class="n">field_value</span> <span class="o">=</span>
    <span class="nb">cass_iterator_get_user_type_field_value</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">);</span>

  <span class="cm">/* ... */</span>
<span class="p">}</span>

<span class="cm">/* The UDT iterator needs to be freed */</span>
<span class="nb">cass_iterator_free</span><span class="p">(</span><span class="n">udt_iterator</span><span class="p">);</span>
</code></pre>


        </div>
      </div>
    </div>

    

    <script src="../../../../js/jquery.js"></script>
    <script src="../../../../js/bootstrap.js"></script>
    <script src="../../../../js/angular.js"></script>
    <script src="../../../../js/mousetrap.js"></script>
    <script src="../../../../js/hotkeys.js"></script>
    <script src="../../../../js/ZeroClipboard.js"></script>
    <script src="../../../../js/lunr.js"></script>
    <script src="../../../../js/app.js"></script>
  </body>
</html>
