<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="DataStax C++ Driver for Apache Cassandra Documentation">
    <meta name="author" content="DataStax">

    <title>DataStax C/C++ Driver - Getting Started</title>

    <link rel="icon" href="../../favicon.ico">
    <link rel="apple-touch-icon" href="../../favicon.png">
    <link href="../../css/style.css" rel="stylesheet">
    <link href="../../css/pygments.css" rel="stylesheet">
    <link href="../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs">
    <div class="navbar">
      <div class="container-fluid">
        <div class="row row-offcanvas row-offcanvas-left">
          <div class="col-sm-3 text-center">
            <a class="ds-home" href="../"><img alt="Brand" src="../../img/logo.png"></a>
            <ul class="list-inline ds-sites" role="nav">
              <li><a href="https://academy.datastax.com/" class="navbar-link">DataStax Academy</a></li>
              <li><a href="http://www.datastax.com/dev/blog" class="navbar-link">Tech Blog</a></li>
              <li><a href="http://www.datastax.com/what-we-offer/products-services/support" class="navbar-link">Support</a></li>
            </ul>
          </div>
          <div class="col-md-5">
            <p class="lead pubtitle">DataStax C/C++ Driver</p>
            
            <div class="text-info">
              <span class="text-warning">Attention:</span> Viewing documentation for version
              <div class="btn-group">
                <button id="current-version" class="btn btn-default btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  2.3
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                
                  <li><a href="../../topics/">2.6</a></li>
                
                  <li><a href="../../2.5/topics/">2.5</a></li>
                
                  <li><a href="../../2.4/topics/">2.4</a></li>
                
                  <li class="disabled"><a href="./">2.3</a></li>
                
                  <li><a href="../../2.2/topics/">2.2</a></li>
                
                  <li><a href="../../2.1/topics/">2.1</a></li>
                
                  <li><a href="../../2.0/topics/">2.0</a></li>
                
                  <li><a href="../../1.0/topics/">1.0</a></li>
                
                </ul>
              </div>
            </div>
            
          </div>
          <div class="col-md-4">
            <form id="search" class="form-search dropdown visible-lg-inline-block" ng-controller="search" ng-class="{open: hasResults}" role="search" ng-submit="submit()" data-spy="affix" data-offset-top="130">
              <div class="form-group has-feedback">
                <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('2.3')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
              </div>
              <ul class="dropdown-menu search-results" role="menu">
                <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
              </ul>
            </form>
            <a href="http://www.datastax.com/download" class="btn btn-primary btn-sm">Download</a>
          </div>
        </div>
      </div>
    </div>

    <div class="container-fluid" id="content">
      <div class="row">
        <div class="col-md-3">
          <div id="navigation" class="side-nav" role="tablist" aria-multiselectable="true">
            <h3><a href="../">Contents</a></h3>
            <ul class="nav nav-pills nav-stacked">
  
  
  <li class="active">
    <a href="./" class="current">
      Getting Started <small>page</small>
      
      
      <span class="glyphicon glyphicon-minus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    <ul class="nav nav-pills nav-stacked">
  
  
  <li>
    <a href="building/">
      Building <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="basics/">
      Basics <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="security/">
      Security <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="logging/">
      Logging <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="configuration/">
      Configuration <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
  
  <li>
    <a href="faq/">
      FAQ <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="metrics/">
      Metrics <small>page</small>
      
    </a>
    
  </li>
  
  
  <li>
    <a href="testing/">
      Testing <small>page</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

  </li>
  
  
  <li>
    <a href="../api/">
      API docs <small>index</small>
      
      
      <span class="glyphicon glyphicon-plus-sign pull-right" aria-hidden="true"></span>
      
      
    </a>
    
  </li>
  
</ul>

          </div>
        </div>
        <div class="col-md-9 content">
          <div class="crumbs-wrapper">
            <nav id="crumbs" data-spy="affix" data-offset-top="130">
              <ol class="breadcrumb">
                
                
                
                <li><a href="../">Home</a></li>
                
                
                
                
                
                <li class="active">Getting Started</li>
                
                
                
              </ol>
            </nav>
          </div>
          

<h1 id="getting-started" class="target">Getting Started<a class="anchor" href="#getting-started" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>

<h2 id="installation" class="target">Installation<a class="anchor" href="#installation" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>CentOS, Ubuntu and Windows. Packages for the dependencies, libuv (1.x) and OpenSSL, are also
provided and can be found under the “dependencies” directory for each
platform e.g. <a href="http://downloads.datastax.com/cpp-driver/centos/7/dependencies/">CentOS 7</a>,
<a href="http://downloads.datastax.com/cpp-driver/ubuntu/14.04/dependencies/">Ubuntu 14.04</a>,
<a href="http://downloads.datastax.com/cpp-driver/windows/dependencies/">Windows</a>.</p>

<p><em>Note</em>: CentOS and Ubuntu use the version of OpenSSL provided with the
distribution.</p>

<p>The driver can also be <a href="building/">built from
source</a>.</p>

<h2 id="connecting" class="target">Connecting<a class="anchor" href="#connecting" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<pre class="highlight"><code><span class="cp">#include &lt;cassandra.h&gt;
#include &lt;stdio.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="cm">/* Setup and connect to cluster */</span>
  <span class="nc">CassCluster</span><span class="o">*</span> <span class="n">cluster</span> <span class="o">=</span> <span class="nb">cass_cluster_new</span><span class="p">();</span>
  <span class="nc">CassSession</span><span class="o">*</span> <span class="n">session</span> <span class="o">=</span> <span class="nb">cass_session_new</span><span class="p">();</span>

  <span class="cm">/* Add contact points */</span>
  <span class="nb">cass_cluster_set_contact_points</span><span class="p">(</span><span class="n">cluster</span><span class="p">,</span> <span class="s">"127.0.0.1"</span><span class="p">);</span>

  <span class="cm">/* Provide the cluster object as configuration to connect the session */</span>
  <span class="nc">CassFuture</span><span class="o">*</span> <span class="n">connect_future</span> <span class="o">=</span> <span class="nb">cass_session_connect</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">cluster</span><span class="p">);</span>

  <span class="cm">/* This operation will block until the result is ready */</span>
  <span class="nc">CassError</span> <span class="n">rc</span> <span class="o">=</span> <span class="nb">cass_future_error_code</span><span class="p">(</span><span class="n">connect_future</span><span class="p">);</span>

  <span class="n">printf</span><span class="p">(</span><span class="s">"Connect result: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nb">cass_error_desc</span><span class="p">(</span><span class="n">rc</span><span class="p">));</span>

  <span class="cm">/* Run queries... */</span>

  <span class="nb">cass_future_free</span><span class="p">(</span><span class="n">connect_future</span><span class="p">);</span>
  <span class="nb">cass_session_free</span><span class="p">(</span><span class="n">session</span><span class="p">);</span>
  <span class="nb">cass_cluster_free</span><span class="p">(</span><span class="n">cluster</span><span class="p">);</span>

  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
<p>To connect a session, a <a href="../api/struct.CassCluster/"><code>CassCluster</code></a> object will need to be created and configured. The minimal configuration needed to connect is a list of contact points. The contact points are used to initialize the driver and it will automatically discover the rest of the nodes in your cluster.</p>

<p><strong>Perfomance Tip:</strong> Include more than one contact point to be robust against node failures.</p>

<h2 id="futures" class="target">Futures<a class="anchor" href="#futures" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The driver is designed so that no operation will force an application to block. Operations that would normally cause the application to block, such as connecting to a cluster or running a query, instead return a <a href="../api/struct.CassFuture/"><code>CassFuture</code></a> object that can be waited on, polled, or used to register a callback.</p>

<p><strong>NOTE:</strong> The API can also be used synchronously by waiting on or immediately attempting to get the result from a future.</p>

<h2 id="executing-queries" class="target">Executing Queries<a class="anchor" href="#executing-queries" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>Queries are executed using <a href="../api/struct.CassStatement/"><code>CassStatement</code></a> objects. Statements encapsulate the query string and the query parameters. Query parameters are not supported by earlier versions of Cassandra (1.2 and below) and values need to be inlined in the query string itself.</p>
<pre class="highlight"><code><span class="cm">/* Create a statement with zero parameters */</span>
<span class="nc">CassStatement</span><span class="o">*</span> <span class="n">statement</span>
  <span class="o">=</span> <span class="nb">cass_statement_new</span><span class="p">(</span><span class="s">"INSERT INTO example (key, value) VALUES ('abc', 123)"</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

<span class="nc">CassFuture</span><span class="o">*</span> <span class="n">query_future</span> <span class="o">=</span> <span class="nb">cass_session_execute</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">statement</span><span class="p">);</span>

<span class="cm">/* Statement objects can be freed immediately after being executed */</span>
<span class="nb">cass_statement_free</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>

<span class="cm">/* This will block until the query has finished */</span>
<span class="nc">CassError</span> <span class="n">rc</span> <span class="o">=</span> <span class="nb">cass_future_error_code</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"Query result: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nb">cass_error_desc</span><span class="p">(</span><span class="n">rc</span><span class="p">));</span>

<span class="nb">cass_future_free</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>
</code></pre>
<h2 id="parameterized-queries-positional" class="target">Parameterized Queries (Positional)<a class="anchor" href="#parameterized-queries-positional" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>Cassandra 2.0+ supports the use of parameterized queries. This allows the same query string to be executed multiple times with different values; avoiding string manipulation in your application.</p>

<p><strong>Perfomance Tip:</strong> If the same query is being reused multiple times, <a href="basics/prepared_statements/">prepared statements</a> should be used to optimize performance.</p>
<pre class="highlight"><code><span class="cm">/* There are two bind variables in the query string */</span>
<span class="nc">CassStatement</span><span class="o">*</span> <span class="n">statement</span>
  <span class="o">=</span> <span class="nb">cass_statement_new</span><span class="p">(</span><span class="s">"INSERT INTO example (key, value) VALUES (?, ?)"</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="cm">/* Bind the values using the indices of the bind variables */</span>
<span class="nb">cass_statement_bind_string</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">"abc"</span><span class="p">);</span>
<span class="nb">cass_statement_bind_int32</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">123</span><span class="p">);</span>

<span class="nc">CassFuture</span><span class="o">*</span> <span class="n">query_future</span> <span class="o">=</span> <span class="nb">cass_session_execute</span><span class="p">(</span><span class="n">session</span><span class="p">,</span> <span class="n">statement</span><span class="p">);</span>

<span class="cm">/* Statement objects can be freed immediately after being executed */</span>
<span class="nb">cass_statement_free</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>

<span class="cm">/* This will block until the query has finished */</span>
<span class="nc">CassError</span> <span class="n">rc</span> <span class="o">=</span> <span class="nb">cass_future_error_code</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>

<span class="n">printf</span><span class="p">(</span><span class="s">"Query result: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nb">cass_error_desc</span><span class="p">(</span><span class="n">rc</span><span class="p">));</span>

<span class="nb">cass_future_free</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>
</code></pre>
<h2 id="handling-query-results" class="target">Handling Query Results<a class="anchor" href="#handling-query-results" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>A single row can be retrieved using the convenience function <a href="../api/struct.CassResult/#cass-result-first-row"><code>cass_result_first_row()</code></a> to get the first row. A <a href="../api/struct.CassIterator/"><code>CassIterator</code></a> object may also be used to iterate over the returned row(s).</p>
<pre class="highlight"><code><span class="cm">/* Execute "SELECT * FROM example (key, value) WHERE key = 'abc'" */</span>

<span class="cm">/* This will also block until the query returns */</span>
<span class="k">const</span> <span class="nc">CassResult</span><span class="o">*</span> <span class="n">result</span> <span class="o">=</span> <span class="nb">cass_future_get_result</span><span class="p">(</span><span class="n">future</span><span class="p">);</span>

<span class="cm">/* If there was an error then the result won't be available */</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="o">==</span> <span class="nx">NULL</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* Handle error */</span>
  <span class="nb">cass_future_free</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* The future can be freed immediately after getting the result object */</span>
<span class="nb">cass_future_free</span><span class="p">(</span><span class="n">query_future</span><span class="p">);</span>

<span class="cm">/* This can be used to retrieve on the first row of the result */</span>
<span class="k">const</span> <span class="nc">CassRow</span><span class="o">*</span> <span class="n">row</span> <span class="o">=</span> <span class="nb">cass_result_first_row</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>

<span class="cm">/* Now we can retrieve the column values from the row */</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">key</span><span class="p">;</span>
<span class="kt">size_t</span> <span class="n">key_length</span><span class="p">;</span>
<span class="cm">/* Get the column value of "key" by name */</span>
<span class="nb">cass_value_get_string</span><span class="p">(</span><span class="nb">cass_row_get_column_by_name</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s">"key"</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">key</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">key_length</span><span class="p">);</span>

<span class="nb">cass_int32_t</span> <span class="n">value</span><span class="p">;</span>
<span class="cm">/* Get the column value of "value" by name */</span>
<span class="nb">cass_value_get_int32</span><span class="p">(</span><span class="nb">cass_row_get_column_by_name</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="s">"value"</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">value</span><span class="p">);</span>


<span class="cm">/* This will free the result as well as the string pointed to by 'key' */</span>
<span class="nb">cass_result_free</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
</code></pre>
<h1 id="architecture" class="target">Architecture<a class="anchor" href="#architecture" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>

<h2 id="cluster" class="target">Cluster<a class="anchor" href="#cluster" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The <a href="../api/struct.CassCluster/"><code>CassCluster</code></a> object describes a Cassandra cluster’s configuration. The default cluster object is good for most clusters and only requires a single or multiple list of contact points in order to establish a session connection. Once a session is connected using a cluster object its configuration is constant. Modifying the cluster object configuration once a session is established does not alter the session’s configuration.</p>

<h2 id="session" class="target">Session<a class="anchor" href="#session" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>The <a href="../api/struct.CassSession/"><code>CassSession</code></a> object is used for query execution. Internally, a session object also manages a pool of client connections to Cassandra and uses a load balancing policy to distribute requests across those connections. An application should create a single session object per keyspace as a session object is designed to be created once, reused, and shared by multiple threads within the application. The throughput of a session can be scaled by increasing the number of I/O threads. An I/O thread is used to handle reading and writing query request data to and from Cassandra. The number of I/O threads defaults to one per CPU core, but it can be configured using <a href><code>cass_cluster_set_num_threads_io()</code></a>. It’s generally better to create a single session with more I/O threads than multiple sessions with a smaller number of I/O threads. More DataStax driver best practices can be found in this <a href="http://www.datastax.com/dev/blog/4-simple-rules-when-using-the-datastax-drivers-for-cassandra">post</a>.</p>

<h2 id="asynchronous-i-o" class="target">Asynchronous I/O<a class="anchor" href="#asynchronous-i-o" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>Each I/O thread maintains a small number of connections for each node in the
Cassandra cluster and each of those connections can handle several simultaneous
requests using pipelining. Asynchronous I/O and pipelining together allow each
connection to handle several (up to 128 requests with protocol v1/v2 and 32k with
protocol v3/v4) in-flight requests concurrently. This significantly reduces the
number of connections required to be open to Cassandra and
allows the driver to batch requests destined for the same node.</p>

<h2 id="thread-safety" class="target">Thread safety<a class="anchor" href="#thread-safety" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>A <a href="../api/struct.CassSession/"><code>CassSession</code></a> is designed to be used concurrently from multiple threads. <a href="../api/struct.CassFuture/"><code>CassFuture</code></a> is also thread safe. Other than these exclusions, in general, functions that might modify an object’s state are <strong>NOT</strong> thread safe. Objects that are immutable (marked ‘const’) can be read safely by multiple threads.</p>

<p><strong>NOTE:</strong> The object/resource free-ing functions (e.g. cass_cluster_free, cass_session_free, … cass_*_free) cannot be called concurrently on the same instance of an object.</p>

<h2 id="memory-handling" class="target">Memory handling<a class="anchor" href="#memory-handling" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>Values such as strings (<code>const char*</code>),  bytes and decimals (<code>const cass_bytes_t*</code>) point to memory held by the result object. The lifetimes of these values are valid as long as the result object isn’t freed. These values <strong>must</strong> be copied into application memory if they need to live longer than the result object’s lifetime. Primitive types such as <a href="../api/cassandra.h/#cass-int32-t"><code>cass_int32_t</code></a> are copied by the driver because it can be done cheaply without incurring extra allocations.</p>

<p><strong>NOTE:</strong> Advancing an iterator invalidates the value it previously returned.</p>

<h2 id="todo" class="target">TODO<a class="anchor" href="#todo" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>

<p>Here are some features that are missing from the C/C++ driver, but are included with other drivers. The schedule for these features can be found on <a href="https://datastax-oss.atlassian.net/browse/CPP">JIRA</a>.</p>

<ul>
<li>Compression</li>
<li>Query tracing</li>
<li>Event registration and notification</li>
<li>Callback interfaces for load balancing, authentication, reconnection and retry</li>
<li>Generic SASL authentication interface</li>
</ul>


        </div>
      </div>
    </div>

    

    <script src="../../js/jquery.js"></script>
    <script src="../../js/bootstrap.js"></script>
    <script src="../../js/angular.js"></script>
    <script src="../../js/mousetrap.js"></script>
    <script src="../../js/hotkeys.js"></script>
    <script src="../../js/ZeroClipboard.js"></script>
    <script src="../../js/lunr.js"></script>
    <script src="../../js/app.js"></script>
  </body>
</html>
